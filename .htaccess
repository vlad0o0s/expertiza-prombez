RewriteEngine On
RewriteBase /

# Перенаправление старых URL с .php на новые без .php (301 редирект)
# Исключаем sendmail.php из редиректа (для AJAX запросов)
RewriteCond %{THE_REQUEST} \s/+(.+?)\.php[\s?] [NC]
RewriteCond %{REQUEST_URI} !^/sendmail\.php [NC]
RewriteRule ^ /%1? [R=301,L]

# Перенаправление /expertiza-prombezopasnosti на /pages/expertiza-prombezopasnosti.php
RewriteRule ^expertiza-prombezopasnosti/?$ pages/expertiza-prombezopasnosti.php [L]

# Перенаправление /zapros-kommercheskogo-predlozheniya на /pages/zapros-kommercheskogo-predlozheniya.php
RewriteRule ^zapros-kommercheskogo-predlozheniya/?$ pages/zapros-kommercheskogo-predlozheniya.php [L]

# Перенаправление /epb-podemnih-sooruzheniy-i-kranov на /pages/expertiza-template.php
RewriteRule ^epb-podemnih-sooruzheniy-i-kranov/?$ pages/expertiza-template.php [L]

# Перенаправление /about на /pages/about.php
RewriteRule ^about/?$ pages/about.php [L]

# Перенаправление /articles на /pages/articles.php
RewriteRule ^articles/?$ pages/articles.php [L]

# Перенаправление /services на /pages/services.php
RewriteRule ^services/?$ pages/services.php [L]

# Перенаправление /expertiza-promyshlennoy-bezopasnosti на /pages/expertiza-promyshlennoy-bezopasnosti.php
RewriteRule ^expertiza-promyshlennoy-bezopasnosti/?$ pages/expertiza-promyshlennoy-bezopasnosti.php [L]

# Динамические URL статей - проверяем slug в БД
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^articles/([^/]+)/?$ pages/article.php?slug=$1 [L,QSA]

# Перенаправление /laboratoriya-nerazrushayushchego-kontrolya на /pages/laboratoriya-nerazrushayushchego-kontrolya.php
RewriteRule ^laboratoriya-nerazrushayushchego-kontrolya/?$ pages/laboratoriya-nerazrushayushchego-kontrolya.php [L]

# Динамические URL ЭПБ - проверяем slug в БД (должно быть после всех конкретных правил, но перед админкой)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/admin [NC]
RewriteCond %{REQUEST_URI} !^/articles [NC]
RewriteCond %{REQUEST_URI} !^/expertiza-prombezopasnosti [NC]
RewriteCond %{REQUEST_URI} !^/expertiza-promyshlennoy-bezopasnosti [NC]
RewriteCond %{REQUEST_URI} !^/zapros-kommercheskogo-predlozheniya [NC]
RewriteCond %{REQUEST_URI} !^/about [NC]
RewriteCond %{REQUEST_URI} !^/laboratoriya-nerazrushayushchego-kontrolya [NC]
RewriteCond %{REQUEST_URI} !^/services [NC]
RewriteRule ^([^/]+)/?$ pages/epb.php?slug=$1 [L,QSA]

# Админ-панель - явные правила для админки
RewriteRule ^admin/?$ admin/index.php [L]
RewriteRule ^admin/login/?$ admin/login.php [L]
RewriteRule ^admin/dashboard/?$ admin/dashboard.php [L]
RewriteRule ^admin/logout/?$ admin/logout.php [L]
RewriteRule ^admin/articles/?$ admin/articles.php [L]
RewriteRule ^admin/articles/create/?$ admin/articles/create.php [L]
RewriteRule ^admin/articles/edit/?$ admin/articles/edit.php [L]
RewriteRule ^admin/articles/delete/?$ admin/articles/delete.php [L]
RewriteRule ^admin/articles/upload-image/?$ admin/articles/upload-image.php [L]
RewriteRule ^admin/epb/?$ admin/epb.php [L]
RewriteRule ^admin/epb/create/?$ admin/epb/create.php [L]
RewriteRule ^admin/epb/edit/?$ admin/epb/edit.php [L]
RewriteRule ^admin/epb/delete/?$ admin/epb/delete.php [L]

# Если запрашивается файл без расширения, проверяем существование .php файла
# Исключаем админ-панель из этого правила
RewriteCond %{REQUEST_URI} !^/admin [NC]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^(.*)$ $1.php [L]

